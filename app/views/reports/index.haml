= content_for :head do
  = '<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAALIr9CgGSyKEGUvdJz6JbKhQq1UCU9SBkmSXBlazPa3yrPjWakBTWgEUybsIS-DVD0rD6Sw9GTwZC2Q" type="text/javascript"></script>'
  :javascript
    function createMarker(map, report) {
      var point = new GLatLng(report['latitude'], report['longitude']);
      var marker = new GMarker(point, true);
      GEvent.addListener(marker, 'click', function() {
        var minHtml = '';
        minHtml += '<strong>Oil:</strong> ' + report['oil'] + '<br/>';
        minHtml += '<strong>Wildlife:</strong> ' + report['wildlife'] + '<br/>';
        minHtml += '<strong>Lat/Lng:</strong> ' + report['latitude'] + '/' + report['longitude'] + '<br/>';

        var maxHtml = minHtml;

        maxHtml += '<strong>Description</strong> ' + report['description'] + '<br/>';
        if (report['media'])
          maxHtml += '<img src="' + report['media'] + '" />';

        map.openInfoWindowHtml(point, minHtml, { maxContent: maxHtml });
      });

      return marker;
    }

    jQuery(document).ready(function() {
      #{show_map(@reports)}
    });

= render :partial => 'shared/header'

#main
  #path
    You are here:
    = link_to 'Home', root_url
    >>
    %h1 Latest Reports
  
  #content
    #reports.container_12
      .block
        .block_head
          %h2 Latest Reports
        .block_content
          %table{ :cellpadding => "0", :cellspacing => "0", :width => "100%" }
            %tr
              %th
                Date
              %th
                Description
              %th
                Wildlife
              %th
                Oil
              %th
                Wetlands
              %th
                Media
            - for report in @reports do
              %tr{:class => cycle("even", "odd")}
                %td
                  = report.created_at.strftime('%m.%d.%Y')
                %td
                  = truncate(report.description, :length => 25)
                %td
                  = report.wildlife
                %td
                  = report.oil
                %td
                  = report.wetlands
                %td
                  - if report.media?
                    %a{ :href => "#{report.media(:medium)}", :rel => "lightbox[gallery]", :title => "#{truncate(report.description, :length => 100)}" }
                      = image_tag(report.media(:tiny), :alt => "")
                  - else
                    = image_tag('http://placehold.it/50x50')
          = will_paginate(@reports)
      .clear

      %div{:id => 'map', :style => 'width: 100%; height: 300px; border: thin solid black;'}

      .clear

= render :partial => "shared/footer"